<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>osu! {{ current_mod }} Leaderboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <div class="container">
        <a href="/" style="text-decoration: none; color: inherit;">
            <p style="color: var(--osu-pink); margin-bottom: 5px;">‚Üê Tilbage til forsiden</p>
        </a>
        <h1>osu! Top 100 {{ current_mod }} Leaderboard</h1>

        {% if stats %}
        <div class="stats-container">
            {% for player, count in stats %}
            <div class="stat-card">
                <h3>#{{ loop.index }} Dominans</h3>
                <div class="stat-value">{{ count }} scores</div>
                <div class="stat-player" style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 10px;">
                    <a href="/player/{{ player }}" class="stat-player-link" style="display: flex; align-items: center; gap: 8px;">
                        {{ player }}
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <div class="menu">
            {% set mod_links = [
                ('OVERALL', 'OVERALL'), ('NM', 'NM'), ('HD', 'HD'), ('HR', 'HR'), ('DT', 'DT'), 
                ('HDHR', 'HDHR'), ('HDDT', 'HDDT'), ('HRDT', 'HRDT'), ('HDDTHR', '3-MOD'), 
                ('HDDTHRFL', '4-MOD'), ('EZ', 'EZ'), ('FL', 'FL'), ('EZFL', 'EZFL'), 
                ('EZDT', 'EZDT'), ('FLDT', 'FLDT'), ('EZHDDT', 'EZHDDT'), ('EZFLDT', 'EZFLDT')
            ] %}

            {% for mod_id, mod_name in mod_links %}
            <a href="/leaderboard/{{ mod_id }}{% if search_query %}?q={{ search_query }}{% endif %}" 
               class="{{ 'active-mod' if current_mod == mod_id }}">
                {{ mod_name }}
            </a>
            {% endfor %}
        </div>

        <div style="margin: 20px 0;">
            <form action="/leaderboard/{{ current_mod }}" method="GET" style="display: inline-block; position: relative;">
                <input type="text" 
                       name="q" 
                       list="player-list"
                       value="{{ search_query if search_query }}" 
                       placeholder="S√∏g efter spiller..." 
                       style="padding: 12px 20px; border-radius: 25px; border: 2px solid var(--osu-pink); background: #25252d; color: white; width: 300px; outline: none;"
                       autocomplete="off">
                
                <datalist id="player-list">
                    {% for name in all_players %}
                    <option value="{{ name }}">
                    {% endfor %}
                </datalist>
                
                <button type="submit" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--osu-pink); cursor: pointer; font-size: 1.2em;">
                    üîç
                </button>
            </form>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Rank</th>
                    <th style="text-align: left;">Spiller</th>
                    <th>PP</th>
                    <th>Accuracy</th>
                    <th>Mods</th>
                    <th style="text-align: left;">Beatmap</th>
                </tr>
            </thead>
            <tbody>
                {% for s in scores %}
                <tr class="leaderboard-row" 
                    style="background-image: linear-gradient(to right, 
                           rgba(26, 26, 34, 1) 0%, 
                           rgba(26, 26, 34, 0.8) 25%, 
                           rgba(26, 26, 34, 0.4) 100%), 
                        url('https://assets.ppy.sh/beatmaps/{{ s.beatmapset_id if s.beatmapset_id else s.beatmap_id }}/covers/cover@2x.jpg');">
                    
                    <td class="rank">#{{ loop.index }}</td>
                    <td class="user">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <img src="https://a.ppy.sh/{{ s.user_id }}" 
                                 style="width: 32px; height: 32px; border-radius: 4px; border: 1px solid #444;"
                                 onerror="this.src='https://osu.ppy.sh/images/layout/avatar-guest.png';">
                            
                            {% if s.country %}
                            <img src="https://flagcdn.com/{{ s.country|lower }}.svg" 
                                 class="flag" 
                                 alt="{{ s.country }}">
                            {% endif %}
                            
                            <a href="/player/{{ s.user }}">
                                {{ s.user }}
                            </a>
                        </div>
                    </td>
                    <td class="pp">{{ "%.2f"|format(s.pp) }}</td>
                    <td class="acc {{ 'acc-ss' if s.acc == 100 }}">
                        {{ "%.2f"|format(s.acc) }}%
                    </td>
                    
                    <td class="mods-container-cell">
                        <div class="mods-container">
                            {% if s.mods and s.mods != "NM" %}
                                {% for i in range(0, s.mods|length, 2) %}
                                    {% set mod = s.mods[i:i+2]|lower %}
                                    <img src="{{ url_for('static', filename='mods/' + mod + '.png') }}" 
                                         class="mod-icon" 
                                         alt="{{ mod }}">
                                {% endfor %}
                            {% else %}
                                <img src="{{ url_for('static', filename='mods/nomod.png') }}" 
                                     class="mod-icon" 
                                     alt="NM">
                            {% endif %}
                        </div>
                    </td>

                    <td class="map">
                        <a href="https://osu.ppy.sh/b/{{ s.beatmap_id }}" target="_blank">
                            {{ s.map }}
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        {% if not scores %}
        <p style="margin-top: 50px; color: #666;">
            Ingen resultater fundet. S√∏rg for at navnet er stavet korrekt eller ryd s√∏gningen.
        </p>
        {% endif %}
    </div>

    <style>
        .stat-player-link {
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            border-bottom: 1px solid transparent;
        }
        .stat-player-link:hover {
            color: var(--osu-pink);
            border-bottom: 1px solid var(--osu-pink);
        }
        .leaderboard-row .user img.flag {
            width: 20px;
            height: auto;
        }
    </style>

</body>
</html>